<%- include ../header.ejs %>

<div class="row">
  <div class="col-md-4 col-md-offset-4">
    <div class="login-form">
      <h3>充值 DockerCI</h3>

      <div>
        <div class="form-group">
          <input type="email" id="amount" class="form-control" name="amount" placeholder="金额"/>
        </div>
        <button type="submit" id="charge" class="btn btn-default ui green">充值</button>
      </div>
    </div>
  </div>
</div>

<script>
  $('#charge').click(function () {
    if ($('#amount').val() == '') {
      alert('请输入充值金额');
    } else {
      $.post('/user/charge', {
        'amount': $('#amount').val()
      }, function (charge) {
        if (charge) {
          pingpp.createPayment(charge, function(result, error){
            if (result == "success") {
              // 只有微信公众账号 wx_pub 支付成功的结果会在这里返回，其他的 wap 支付结果都是在 extra 中对应的 URL 跳转。
            } else if (result == "fail") {
              // charge 不正确或者微信公众账号支付失败时会在此处返回
            } else if (result == "cancel") {
              // 微信公众账号支付取消支付
            }
          });
        }
      });
    }
  });
</script>

<%- include ../footer.ejs %>
